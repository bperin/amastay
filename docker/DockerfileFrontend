# Build stage
FROM node:18-alpine as build

WORKDIR /app

# Debug: Show environment at start
RUN echo "=== Build Starting ==="
RUN echo "Current directory: $(pwd)"
RUN echo "Directory contents: $(ls -la)"

COPY package*.json ./
RUN npm install

COPY . .

#

# Debug: Show VITE_BASE_URL
ARG VITE_BASE_URL
ENV VITE_BASE_URL=${VITE_BASE_URL}
RUN echo "=== Build Arguments ==="
RUN echo "VITE_BASE_URL: ${VITE_BASE_URL}"
RUN echo "Directory contents after copy: $(ls -la)"

# Debug: Show env before build
RUN echo "=== Starting npm build ==="
RUN env
RUN npm run build
RUN echo "=== Build complete ==="
RUN echo "Build output: $(ls -la dist)"

# Production stage
FROM nginx:alpine

# Debug: Show copy operations
RUN echo "=== Starting nginx stage ==="
COPY --from=build /app/dist /usr/share/nginx/html
RUN echo "Nginx html contents: $(ls -la /usr/share/nginx/html)"

COPY nginx.conf /etc/nginx/conf.d/default.conf
RUN echo "Nginx config: $(cat /etc/nginx/conf.d/default.conf)"

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
